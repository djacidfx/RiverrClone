##################################
# Disable directory listing
##################################
Options -Indexes

##################################
# Protect sensitive files
##################################
<FilesMatch "^(\.env|\.env\.example|_ide_helper\.php)$">
    Require all denied
</FilesMatch>

##################################
# Security headers
##################################
<IfModule mod_headers.c>
    Header always set X-Frame-Options "DENY"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
</IfModule>

##################################
# Compression (modern)
##################################
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE \
        text/plain text/html text/xml text/css \
        application/json application/javascript application/xml \
        image/svg+xml font/ttf font/otf font/woff font/woff2

    BrowserMatch ^Mozilla/4 gzip-only-text/html
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
    Header append Vary User-Agent
</IfModule>

##################################
# Rewrite rules
##################################
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Remove index.php from URLs
    RewriteRule ^index\.php/(.*)$ /$1 [R=301,L]

    # Authorization header fix
    RewriteCond %{HTTP:Authorization} .
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

    # Remove trailing slash if not a directory
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} (.+)/$
    RewriteRule ^ %1 [R=301,L]

    # Front controller
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^ index.php [L]
</IfModule>

##################################
# Browser caching
##################################
<IfModule mod_expires.c>
    ExpiresActive On

    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType video/mp4 "access plus 1 year"
</IfModule>

##################################
# LiteSpeed (ONLY if required by host)
##################################
<IfModule LiteSpeed>
    # Leave empty unless host requires rules here
</IfModule>
